function r = cca(X,Y)
%Y=[4106.64653005270,4377.54822683934,4435.03119954236,4195.04530456621,4436.87609376063,4525.86263120785,4596.53700855057,4409.84205920886,4464.32335526322,4104.14019458986,3896.33307597949,4489.49318170152,4301.26087030515,4274.49480934156;4091.07902583793,4365.94458475392,4418.27392539609,4194.01854075196,4414.44848937995,4502.73716065497,4579.10501049182,4386.03543467217,4431.52423881137,4108.81780928762,3874.35678700859,4463.24791370423,4274.14270572017,4252.48709890968;4103.20152854048,4400.28351797049,4428.99514257567,4208.26190612141,4455.16894745155,4518.53664418492,4591.33137511924,4405.90419965639,4450.91290645065,4128.08132025615,3898.33176768898,4483.38605387000,4270.86629264381,4270.45020741514;4098.56139724433,4440.03852896733,4425.88652654521,4192.07485316947,4463.55859502088,4530.69035084291,4586.13935681998,4408.88144116298,4462.86893352434,4123.46711663612,3921.85527328006,4491.31692757191,4294.37943729878,4275.79593574638;4092.91334536368,4399.50157499309,4430.26443509841,4133.75902390032,4414.23215056395,4504.91240604777,4583.14924822779,4398.96326095009,4444.53188511579,4100.31398838539,3899.74236656264,4468.63881857728,4264.36389808893,4254.31216909098;4084.29458955155,4402.21707470663,4424.18017627017,4143.44419030569,4417.92200426085,4512.46875417826,4588.21981248213,4380.77664620581,4438.51889796302,4140.59601070648,3901.74064594936,4459.32206309151,4260.35416299463,4244.89500371531;4092.27197298957,4443.41980482831,4425.10307674756,4218.23639802082,4455.17714832948,4535.48527326539,4600.04370480505,4392.41405440954,4448.93908916311,4141.81089571193,3912.81600709049,4475.60150427113,4266.34908456640,4262.22805258719;4100.67118330874,4431.03839469450,4434.36984325153,4211.85453591771,4444.84546280179,4525.34521229437,4594.12003303118,4411.57142002964,4457.84830573001,4069.47839354544,3902.02988949157,4477.35976841555,4260.39171460197,4266.70943286724;4078.36428833585,4378.76744188641,4417.69687151673,4146.55859635443,4384.89054968439,4497.71625853228,4585.55484730465,4399.18987606801,4431.02643867693,4078.98429487078,3887.68484480242,4453.96265107629,4222.82607525267,4235.58849814691;4070.28447337387,4371.57905337971,4408.17468891218,4131.83699222351,4368.86394633675,4492.32397009772,4583.38324295239,4392.18425496765,4431.23571828597,4098.64792865235,3888.44819115164,4452.34664045903,4207.29235614308,4230.04873338254;4097.98652167720,4415.98042769120,4433.64877137912,4155.35128234679,4428.51918025922,4512.73018143497,4583.79601658298,4410.06939067935,4467.26143567024,4101.73708294660,3915.40601326217,4479.55154795450,4218.34072214466,4267.63685165848;4125.53536887986,4438.61586844370,4458.09697162648,4196.48932483803,4463.69103423204,4531.18125808202,4605.26045939768,4430.07150136173,4479.98496737185,4131.50417606738,3909.42025098842,4496.36586725667,4257.92729857082,4282.91497188261;4107.49627328918,4414.61056852030,4447.98313304240,4191.67218235811,4427.94377604307,4503.10897824159,4593.38830707391,4413.28615301236,4470.03774040223,4151.04924097413,3901.99449046151,4482.03230438333,4270.58394077406,4269.61223144795;4108.79562189290,4431.25542446760,4450.91337890253,4179.96994630895,4432.56972103533,4509.84969306202,4604.73409292493,4426.62147524139,4491.38188844764,4153.72265226027,3945.21609708432,4493.10987537119,4261.17876277702,4283.64722600790;4112.63379837390,4421.64120694799,4448.61444018256,4166.30002151349,4407.48982931535,4513.24775061287,4611.57682591715,4429.29343470147,4478.19249117241,4117.34769327583,3917.84516695796,4489.78252745068,4254.41347958340,4275.78001584205;4109.49655841023,4394.36206290403,4448.12587978992,4168.37890891526,4398.56831963743,4504.96179291664,4600.55931343239,4409.22956032253,4443.25078247329,4136.51666298632,3884.52751611063,4477.75355745249,4254.45459139257,4260.85621896462;4117.79906423770,4394.66328186100,4448.47798517372,4163.99289519205,4426.69767211365,4506.40530128601,4585.80264496615,4393.58811871600,4457.68362039864,4142.18747569142,3913.59887083581,4479.58590469332,4238.97786352517,4265.31555338107;4121.93165422316,4423.73574955008,4455.82864083715,4177.11972196751,4424.24389289466,4508.85504745885,4595.03833016489,4408.07773424786,4459.27462293747,4116.99822248404,3910.59589719912,4486.43250459985,4238.84572553574,4270.27310612185;4115.65963177841,4426.95195215209,4450.47851849440,4202.00064622283,4423.67832266012,4509.78723669422,4598.77709124227,4410.12500474118,4450.06177316542,4122.64868939244,3893.74943565755,4481.72255581784,4252.13682018963,4258.79556314706;4108.61188898064,4381.08491713429,4440.74276087536,4187.10480982915,4397.05474265064,4505.87822989724,4592.92333798063,4400.08263943845,4458.48887630180,4123.06412144033,3915.24474167657,4473.49674554970,4240.03781208314,4253.40117244265;4100.07153336147,4368.00197596881,4441.49344027056,4132.34078976593,4369.73290787373,4485.13089697195,4585.45293661718,4396.20429298968,4436.21292817786,4085.48590184387,3924.87421502013,4467.58906434187,4212.88767031894,4248.63217491111;4097.36969360160,4369.06371240182,4435.97032006142,4172.86277044194,4394.59751707149,4494.84488529492,4587.58973118219,4391.75167132230,4440.10937152395,4125.39984090925,3930.82159738044,4462.13417152680,4221.09739240856,4248.88862955202;4080.37840188247,4347.24078561140,4416.80388917125,4185.11369811357,4382.25318512866,4492.92457539179,4578.40746843761,4378.26355622600,4438.21711789472,4106.04161262027,3924.43295018330,4447.44782913390,4228.85214645081,4235.09900655124;4082.25700669334,4360.84549086038,4424.12287596490,4117.67721657371,4378.89373648155,4489.32228115093,4580.11985463112,4388.81947242702,4445.66837648756,4073.46830458506,3933.17174404606,4456.81157715471,4209.71175979970,4238.14407375955;4107.51173528684,4379.36635378885,4440.30840332888,4158.13976579355,4386.00226237973,4489.39905592849,4586.80202005716,4400.47954894506,4449.87886710307,4091.61599329985,3946.60286382848,4476.79027992188,4193.09121131265,4261.19428529393;4120.13083303088,4367.48432508858,4454.17398934940,4145.27989329149,4393.25398698037,4490.21032648525,4590.94654169427,4391.57549429890,4433.40565771233,4087.68719073564,3927.98865989910,4473.19548493548,4224.19032432919,4259.76953488226;4119.86212690610,4394.02041637124,4455.94902125488,4129.20765546631,4434.28329373560,4517.76474310870,4605.51966864188,4406.57118225511,4457.27316881877,4125.34418850502,3923.56759223781,4476.30803551045,4246.10487023544,4264.40210134563;4108.53413980054,4392.53888368502,4445.50969556305,4161.74499495038,4419.65707031914,4509.82163363866,4596.89742291348,4418.70985541255,4476.81308677955,4125.00084515695,3948.41392097710,4483.48503743531,4203.96196961613,4269.10031936914;4118.44549507773,4386.14846647334,4456.80420473514,4161.12675630529,4399.95175200178,4516.02971665785,4611.43218030281,4418.56085257622,4471.91384670981,4163.56794664983,3962.04607152559,4491.51808665281,4238.13574991197,4278.02313643854;4112.17363641289,4384.89674165936,4449.26018951063,4139.32919314943,4412.86407073935,4513.13094328581,4612.99382418992,4419.44120183924,4470.91251657895,4145.10360674106,3955.87723641075,4488.30163709485,4244.18096456655,4274.70439795212;4093.60674968050,4345.03151106142,4433.17738236671,4122.47387032030,4379.64706540468,4481.73589859609,4586.79408127400,4408.66376039136,4456.26543349907,4079.42811411313,3951.72069863503,4469.46140177484,4214.12065341332,4255.36644493223;4110.72490103087,4367.83452095620,4444.74563744307,4164.91708722720,4372.22627250729,4492.07856739912,4593.28238325809,4413.18504697120,4467.09728269033,4122.27043064768,3965.34411551252,4486.52142298064,4218.95763736070,4271.13029133220;4094.83600444739,4316.77261266520,4435.64906596281,4104.52317953511,4333.41386141290,4479.28775551424,4578.29039383014,4389.90063447461,4443.00748354711,4065.59052119734,3934.74372663801,4463.79862851751,4187.42053846174,4248.34091577843;4097.65269214808,4307.17933725980,4435.42484722315,4096.13780353059,4328.27908492683,4476.98722648912,4577.79450777012,4385.99722673152,4443.74565726937,4098.70364228403,3938.78775104329,4465.04975856655,4200.18170018359,4244.88652479333;4142.32511009331,4408.36910751413,4470.37448562147,4199.19058887478,4445.97809254774,4526.34834219371,4618.12481915147,4439.37588950941,4503.12309500372,4182.30656673513,4004.98621859892,4518.04416942295,4260.09719853335,4298.00881641234;4152.45078261231,4409.47189975998,4484.83500851200,4201.07647784111,4461.66277412050,4526.91239940987,4618.16018519004,4453.42076017532,4503.75752795386,4156.37892987046,4009.21132484839,4525.27601222828,4255.60571583482,4309.92384491744;4105.61817063967,4330.91493149439,4446.82201622541,4129.57742120347,4345.01704668003,4493.90261036133,4598.70520481283,4403.50237861094,4451.43418235259,4126.58114563216,3954.90400487820,4476.68109118570,4206.35481359833,4253.60560774857;4120.20806355819,4341.41621821254,4458.10000442591,4133.56774417204,4385.13424852172,4515.56356719810,4616.14679983767,4419.10350061563,4462.59437416021,4142.68947056961,3968.10299127351,4496.94734582203,4243.77397802619,4272.47931076658;4130.53625588392,4361.84773826281,4462.54634500413,4167.46350810908,4431.57151834889,4509.92624290380,4609.29960091336,4431.36514609271,4481.20879811764,4148.20730769894,3981.58167908464,4509.53755635945,4250.05584522555,4284.84059708090;4109.26773434609,4320.90477054325,4446.78456703483,4144.39575988947,4381.83338822990,4493.86174352631,4595.39275490740,4410.01464186617,4457.18129705953,4107.74739317726,3968.87946630392,4478.28441734460,4207.30995073700,4255.03699541069;4158.19037091016,4350.56300899081,4488.43897168232,4158.03543875186,4508.71369443263,4520.02167737937,4610.71609154044,4452.70435846626,4487.62229521833,4184.46929603852,4004.21964352797,4527.08339294515,4268.64799673560,4305.97394868645;4153.34853286972,4322.86756522097,4485.70579320144,4178.77799609867,4514.68895098586,4512.53785730488,4617.15335149281,4444.38643383157,4480.57651999785,4170.79391746123,3996.66331127191,4520.64574218067,4265.36974213962,4302.78663293946;4108.11961543818,4310.64963133910,4444.57966292767,4121.08536254540,4420.76821517878,4497.14076401755,4600.25101451886,4405.40800635386,4452.25475871327,4119.73279748606,3977.11468829956,4485.40250330920,4212.94985958308,4267.01577770466;4089.32928301159,4316.09268837019,4423.81448729886,4074.04831003486,4428.17531621965,4496.32331432037,4592.82136681440,4394.09784873492,4443.48103127977,4094.47887769992,3943.78568852084,4472.03152604029,4216.97506402815,4246.73612987135;4113.58190825509,4303.91500096570,4443.45368808182,4130.54704674160,4503.96311395622,4497.34570173710,4600.13346768919,4429.28598981132,4472.91886167423,4083.41057171197,3971.86039962250,4489.19689219404,4247.96174046961,4269.06901626827;4097.16845656315,4326.58544232579,4428.90128488178,4111.18937629608,4492.68126071025,4492.63200337662,4587.35514415005,4421.38351018619,4469.43657783919,4101.98265064789,3958.97960347427,4475.98531466819,4228.09688969714,4255.30769708743;4101.28686615830,4355.20022099793,4435.53816641674,4134.33883580072,4505.59671224505,4512.47991517633,4608.30608888494,4418.16806399993,4470.54533285962,4136.82168031181,3942.50868576241,4479.95334133582,4224.58323282620,4257.20136310349;4138.31057684251,4345.38390527601,4465.02546967449,4194.34647721728,4564.18430128768,4515.75798974635,4618.47005458540,4431.48256672070,4482.87649124382,4188.56098983703,3981.10499249876,4510.79379724703,4264.43413384072,4292.03400759058;4119.12670992582,4333.48682264665,4446.65938162391,4203.69638760393,4560.97230828286,4518.28041875347,4610.96509016334,4424.80322338565,4480.86495670630,4126.54061760009,3965.43491096035,4494.79490060373,4253.29964785334,4274.29548478890;4112.09746984879,4345.36340503321,4439.91274495203,4131.40886602380,4535.06959704853,4499.84460996841,4617.98758175763,4420.87467370411,4482.57845975861,4153.19314180332,3951.60369951441,4491.42282518439,4279.34892975133,4271.79051218659;4112.41390105463,4323.63799393439,4440.46149569016,4084.68633788959,4494.67390756311,4481.95634749776,4606.21185922149,4412.62197372763,4465.52727418776,4169.40849732470,3957.41276170437,4490.60985769625,4251.80716366747,4270.35437852737;4133.26106898054,4336.91567302886,4457.12352358322,4158.84039342554,4570.98617350917,4514.26064138697,4610.92526213537,4441.42825250632,4492.72899563737,4152.50895893113,3993.58290881009,4508.40176488566,4243.84357176538,4289.00993710114;4108.24359306139,4309.06241809635,4439.59062285712,4114.16651979829,4522.26238568025,4503.36911123937,4598.77769230557,4420.34065700101,4473.48506460014,4096.15903735842,3963.43155883034,4480.57997762400,4256.11902864971,4260.61780926693;4102.99379980061,4287.20938419480,4432.19703636109,4122.94836664260,4523.44705160490,4504.36650441195,4611.68352499395,4416.56958066398,4473.55365607974,4137.36206778396,3974.16912530712,4481.58604591882,4257.05932843173,4262.39908406033;4112.69591823726,4312.50501076207,4432.33715832608,4137.63607347475,4558.76183278111,4499.29365681939,4624.97219764106,4418.96035929525,4478.19448439404,4210.78672925766,3995.90764269627,4496.46488452836,4270.24069495218,4279.05164079610;4098.16330858842,4335.89026432236,4424.30690398327,4110.57465140344,4548.76313767384,4490.32224636753,4603.44681315953,4409.21581335801,4469.25012690504,4135.57566067935,3972.17094406595,4481.21304000642,4259.75002901353,4262.38666529947;4114.07917074621,4338.00933659299,4439.82841002048,4154.12968111719,4581.20045228102,4488.20634325874,4607.72246737331,4416.61460331030,4476.68931715020,4138.63464789932,3977.42784266681,4491.76915269227,4275.88190764161,4273.14237778846;4106.57939035580,4322.88963159604,4434.77742406887,4108.47732582742,4528.39702841436,4488.38451123592,4603.71530493882,4409.45740257708,4456.35923769684,4111.78462193302,3981.43823139317,4486.91205928894,4275.21324106049,4267.67276162271;4090.93635171429,4268.34806673245,4424.13842472734,4061.78782878021,4496.65435890295,4497.26778455866,4601.58154208308,4397.44429792756,4450.95497723688,4116.02794109541,3954.47522623414,4468.54226423983,4245.39963120123,4246.19070120662;4120.01229690059,4284.55470767746,4446.30403726855,4164.35681622255,4591.37268867480,4513.06268242193,4624.36293046691,4423.57411702977,4491.73934737657,4193.77046786236,3972.02859270649,4492.72906859653,4278.55258181014,4271.74313442763;4138.42529303745,4366.66969737713,4461.68001856889,4198.77177520079,4616.39309036573,4543.37689789739,4632.68065960667,4446.54734709089,4499.61990001778,4175.71360738925,4009.06022504165,4522.97446561536,4299.33363564109,4300.65320963878;4119.91857024283,4354.32908545054,4447.84112577101,4128.24946390111,4603.27168945097,4536.28600395100,4626.52522330736,4438.03295220839,4489.95274733726,4146.16068571305,3990.84317935451,4505.18170139662,4284.36815185481,4282.78874293193;4104.39704832724,4306.70072655546,4430.59090232739,4110.82335717724,4578.81753982662,4504.12114979633,4618.78401357087,4422.36318217422,4479.66966281348,4110.80576866074,3974.55385575451,4482.59013990158,4260.05576469094,4258.20808509674;4093.39886599368,4272.28672923200,4421.26813152913,4131.35441597823,4518.43758134901,4499.32829297555,4614.92130807156,4400.03397764794,4453.83784454410,4094.60732250676,3957.51857203717,4470.74120885397,4239.21223779143,4243.14737677785];
% CCA calculate canonical correlations
%
% [Wx Wy r] = cca(X,Y) where Wx and Wy contains the canonical correlation
% vectors as columns and r is a vector with corresponding canonical
% correlations. The correlations are sorted in descending order. X and Y
% are matrices where each column is a sample. Hence, X and Y must have
% the same number of columns.
%
% Example: If X is M*K and Y is N*K there are L=MIN(M,N) solutions. Wx is
% then M*L, Wy is N*L and r is L*1.
%
%
% ?? 2000 Magnus Borga, Linkpings universitet

% --- Calculate covariance matrices ---
Y=Y';
X=X';
z = [X;Y];
C = cov(z.');
sx = size(X,1);
sy = size(Y,1);
Cxx = C(1:sx, 1:sx) + 10^(-8)*eye(sx);
Cxy = C(1:sx, sx+1:sx+sy);
Cyx = Cxy';
Cyy = C(sx+1:sx+sy, sx+1:sx+sy) + 10^(-8)*eye(sy);
invCyy = inv(Cyy);

% --- Calcualte Wx and r ---

[Wx,r] = eig(inv(Cxx)*Cxy*invCyy*Cyx); % Basis in X
r = sqrt(real(r));      % Canonical correlations

% --- Sort correlations ---

V = fliplr(Wx);		% reverse order of eigenvectors
r = flipud(diag(r));	% extract eigenvalues and reverse their order
[r,I]= sort((real(r)));	% sort reversed eigenvalues in ascending order
r = flipud(r);	
r=r';
% restore sorted eigenvalues into descending order
for j = 1:length(I)
  Wx(:,j) = V(:,I(j));  % sort reversed eigenvectors in ascending order
end
Wx = fliplr(Wx);	% restore sorted eigenvectors into descending order

% --- Calcualte Wy  ---

Wy = invCyy*Cyx*Wx;     % Basis in Y
% Wy = Wy./repmat(sqrt(sum(abs(Wy).^2)),sy,1); % Normalize Wy
